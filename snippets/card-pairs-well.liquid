{%- assign product_form_id = 'pairs-well-form-' | append: card_product.id | append: '-' | append: section.id -%}
{%- assign current_variant = card_product.selected_or_first_available_variant -%}

<div class="pairs-well-card">
  <div class="pairs-well-media">
    <a href="{{ card_product.url }}">
      <img
        src="{{ card_product.featured_image | image_url: width: 200 }}"
        alt="{{ card_product.title | escape }}"
        loading="lazy"
        width="200"
        height="200"
        class="pairs-well-img"
      >
    </a>
  </div>

  <div class="pairs-well-info">
    <div class="pairs-well-header-info">
      <a href="{{ card_product.url }}" class="pairs-well-title">{{ card_product.title }}</a>
      
      {% comment %} --- BULLETPROOF PRICE BLOCK --- {% endcomment %}
      <div class="pairs-well-price price">
        {% comment %} <s class="pw-compare-price price-item price-item--regular" style=" {% unless current_variant.compare_at_price > current_variant.price %}display: none;{% endunless %}">
          {{ current_variant.compare_at_price | money }}
        </s> {% endcomment %}
        <span class="pw-regular-price price-item {% if current_variant.compare_at_price > current_variant.price %}price-item--sale{% else %}price-item--regular{% endif %}">
          {{ current_variant.price | money }}
        </span>
      </div>

    </div>

    <product-form class="pairs-well-form-wrapper">
      {%- form 'product', card_product, id: product_form_id, class: 'pairs-well-form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
        
        {%- unless card_product.has_only_default_variant -%}
          <div class="pairs-well-variants">
            {%- for option in card_product.options_with_values -%}
              <div class="pairs-well-select-wrapper">
                <label class="visually-hidden">{{ option.name }}</label>
                <select class="pairs-well-select" data-option-index="{{ forloop.index0 }}">
                  {%- for value in option.values -%}
                    <option value="{{ value | escape }}" {% if option.selected_value == value %}selected{% endif %}>
                      {{ value }}
                    </option>
                  {%- endfor -%}
                </select>
                <svg aria-hidden="true" focusable="false" viewBox="0 0 10 6">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"></path>
                </svg>
              </div>
            {%- endfor -%}
          </div>
        {%- endunless -%}

        <script type="application/json" class="pairs-well-variant-json">
          [
          {%- for variant in card_product.variants -%}
            {
              "id": {{ variant.id }},
              "title": "{{ variant.title | escape }}",
              "options": {{ variant.options | json }},
              "available": {{ variant.available }},
              "price": "{{ variant.price | money }}",
              "compare_at_price": {% if variant.compare_at_price > variant.price %}"{{ variant.compare_at_price | money }}"{% else %}null{% endif %},
              "featured_image": "{% if variant.featured_image %}{{ variant.featured_image | image_url: width: 200 }}{% endif %}"
            }{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
          ]
        </script>

        <input type="hidden" name="id" value="{{ current_variant.id }}" class="pairs-well-final-id">

        <button
          type="submit"
          name="add"
          class="pairs-well-btn button button--primary {% unless current_variant.available %}disabled{% endunless %}"
          {% unless current_variant.available %}disabled{% endunless %}
        >
          {%- if current_variant.available -%}
            {{ 'products.product.add_to_cart' | t }}
          {%- else -%}
            {{ 'products.product.sold_out' | t }}
          {%- endif -%}
        </button>
      {%- endform -%}
    </product-form>
  </div>
</div>