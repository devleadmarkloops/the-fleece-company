{%- assign text_direction = 'localization.text_direction_trigger' | t | downcase -%}
<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}"
  {%- if text_direction == 'rtl' %} dir="rtl"{% endif -%}
>
  <head>
    <script src="{{ 'pandectes-rules.js' | file_url }}"></script>
    {% render 'replo-head' %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="">
    <link rel="canonical" href="{{ canonical_url }}">
    <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    {%- unless settings.type_header_font.system? and settings.type_body_font.system? -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endunless -%}

    <title>
      {{ page_title }}
      {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
      {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
      {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
    </title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    {% render 'meta-tags' %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script>
    !(function (e, n, t, i, p, a, s) {
      e[i] ||
        (((p = e[i] =
          function () {
            p.process ? p.process.apply(p, arguments) : p.queue.push(arguments);
          }).queue = []),
        (p.t = +new Date()),
        ((a = n.createElement(t)).async = 1),
        (a.src = 'https://static.newsbreak.com/business/tracking/nbpixel.js?t=' + 864e5 * Math.ceil(new Date() / 864e5)),
        (s = n.getElementsByTagName(t)[0]).parentNode.insertBefore(a, s));
    })(window, document, 'script', 'nbpix'),
      nbpix('init', 'ID-1885415750284668929'),
      nbpix('event', 'pageload');
    </script>

    <script data-obct type = "text/javascript">
      /** DO NOT MODIFY THIS CODE**/
      !function(_window, _document) {
        var OB_ADV_ID = '00671669d458c7010d5ffb2e665f2a3061';
        if (_window.obApi) {
          var toArray = function(object) {
            return Object.prototype.toString.call(object) === '[object Array]' ? object : [object];
          };
          _window.obApi.marketerId = toArray(_window.obApi.marketerId).concat(toArray(OB_ADV_ID));
          return;
        }
        var api = _window.obApi = function() {
          api.dispatch ? api.dispatch.apply(api, arguments) : api.queue.push(arguments);
        };
        api.version = '1.1';
        api.loaded = true;
        api.marketerId = OB_ADV_ID;
        api.queue = [];
        var tag = _document.createElement('script');
        tag.async = true;
        tag.src = '//amplify.outbrain.com/cp/obtp.js';
        tag.type = 'text/javascript';
        var script = _document.getElementsByTagName('script')[0];
        script.parentNode.insertBefore(tag, script);
      }(window, document);

      obApi('track', 'PAGE_VIEW');
    </script>

    <script type="importmap">
      {
        "imports": {
          "mdl-scrollsnap": "{{ 'scrollsnap.js' | asset_url }}",
          "timeline-component": "{{ 'timeline-component.js' | asset_url }}",
          "comparison-table-component": "{{ 'comparison-table-component.js' | asset_url }}",
          "dual-scroll-component": "{{ 'section-dual-scroll.js' | asset_url }}"
        }
      }
    </script>

    <script src="{{ 'vendor-v4.js' | asset_url | split: '?' | first }}" defer="defer"></script>
    <script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'modules-basis.js' | asset_url }}" defer="defer"></script>

    {{ content_for_header }}
{% if template.suffix == 'muslin-blanket-le-new' %}
     {%- liquid
      render 'css-variables-v2'
      echo 'base-v2.css' | asset_url | stylesheet_tag: preload: true
      echo 'custom-v2.css' | asset_url | stylesheet_tag: preload: true
      
      if text_direction == 'rtl'
        echo 'rtl.css' | asset_url | stylesheet_tag
      endif
    -%}
{% else %}
   {%- liquid
      render 'css-variables'
      echo 'base.css' | asset_url | stylesheet_tag: preload: true
      echo 'custom.css' | asset_url | stylesheet_tag: preload: true
      
      if text_direction == 'rtl'
        echo 'rtl.css' | asset_url | stylesheet_tag
      endif
    -%}
{% endif %}
 

    <link rel="stylesheet" href="{{ 'apps.css' | asset_url }}" media="print" fetchpriority="low" onload="this.media='all'">

    {% # theme-check-disable %}
    {%- unless settings.type_body_font.system? -%}
      <link
        rel="preload"
        as="font"
        href="{{ settings.type_body_font | font_url }}"
        type="font/woff2"
        crossorigin
      >
    {%- endunless -%}
    {%- unless settings.type_header_font.system? -%}
      <link
        rel="preload"
        as="font"
        href="{{ settings.type_header_font | font_url }}"
        type="font/woff2"
        crossorigin
      >
    {%- endunless -%}
    {% # theme-check-enable %}
    
    {%- if settings.predictive_search_enabled -%}
      <link rel="stylesheet" href="{{ 'component-predictive-search.css' | asset_url }}" media="print" onload="this.media='all'">
    {%- endif -%}
    {%- if settings.quick_view_enabled -%}
      <link rel="stylesheet" href="{{ 'component-quick-view.css' | asset_url }}" media="print" onload="this.media='all'">
    {%- endif -%}
    {%- if settings.color_swatches_enabled -%}
      <link rel="stylesheet" href="{{ 'component-color-swatches.css' | asset_url }}" media="print" onload="this.media='all'">
    {%- endif -%}
    {%- if linklists.gift-wrapping.links != blank and linklists.gift-wrapping.links.first.type == 'product_link' -%}
      <link rel="stylesheet" href="{{ 'component-gift-wrapping.css' | asset_url }}" media="print" onload="this.media='all'">
      <noscript>{{ 'component-gift-wrapping.css' | asset_url | stylesheet_tag }}</noscript>
    {%- endif -%}

    {%- render 'js-variables' -%}

    <script>
      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
      if (Shopify.designMode) {
        document.documentElement.classList.add('shopify-design-mode');
      }
    </script><link rel="preload" href="https://quickstart-41d588e3.myshopify.com/cdn/shop/t/3/assets/lazysizes-8.0.50.js" as="script"><script src="https://quickstart-41d588e3.myshopify.com/cdn/shop/t/3/assets/lazysizes-8.0.50.js"></script>

    <!-- Taboola Pixel Code -->
    <script type='text/javascript'>
      window._tfa = window._tfa || [];
      window._tfa.push({notify: 'event', name: 'page_view', id: 1776931});
      !function (t, f, a, x) {
            if (!document.getElementById(x)) {
                t.async = 1;t.src = a;t.id=x;f.parentNode.insertBefore(t, f);
            }
      }(document.createElement('script'),
      document.getElementsByTagName('script')[0],
      '//cdn.taboola.com/libtrc/unip/1776931/tfa.js',
      'tb_tfa_script');
    </script>
    <!-- End of Taboola Pixel Code -->

    {%- if content_for_header contains "elevateab.app" -%}{%- unless request.design_mode -%} <script>try{window.eab_data={selectors:JSON.parse(`{{shop.metafields.elevateab.select}}`)||{},allTests:JSON.parse(`{{shop.metafields.elevateab.tests}}`)||{},currencyFormat:{% if settings.currency_code_enabled %}"{{ shop.money_with_currency_format}}"{% else %}"{{ shop.money_format}}"{% endif %}};}catch(error){console.log(error);window.eab_data={selectors:{},allTests:{},currencyFormat:{% if settings.currency_code_enabled %}"{{ shop.money_with_currency_format}}"{% else %}"{{ shop.money_format}}"{% endif %}};}</script><script src="https://ds0wlyksfn0sb.cloudfront.net/redirect.js"></script> {%- endunless -%}{%- endif -%} 
    {% render 'kiwiSizing' %}
    {% if settings.clarity_product_templates != blank and template.name == 'product' %}
      {% assign clarity_templates = settings.clarity_product_templates | split: ',' %}
      {% for tmpl in clarity_templates %}
        {% assign clean_template = tmpl | strip | downcase %}
        {% if template.suffix == clean_template %}
          <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
              c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
              t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/v5ev3r1bgu";
              y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "v5ev3r1bgu");
          </script>
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
    
  </head>

  <body class="template-{{ request.page_type }}{% if request.design_mode %} shopify-design-mode{% endif %}"
    {%- if settings.image_zoom_effect_enabled %} data-animate-image{% endif -%}
    {%- if settings.image_loading_bar_enabled %} data-lazy-image{% endif -%}
    {%- if settings.heading_capitalize %} data-heading-capitalize{% endif -%}
    {%- if settings.heading_center %} data-heading-center{% endif -%}
    {%- if settings.price_superscript %} data-price-superscript{% endif -%}
    {%- if settings.button_corner_radius > 0 %} data-button-round{% endif -%}
  >
    {% liquid
      assign protection_product = all_products['cozycareâ„¢-order-protection']
      for item in cart.items
      if item.product_id == protection_product.id
        assign protection_key = 1
      endif
      endfor
    %}

<div hidden class="remove-protection-d5" data-key="{{ protection_key }}"></div>
    <a class="skip-to-content-link button button--small visually-hidden" href="#MainContent">
      {{ "accessibility.skip_to_text" | t }}
    </a>

    {% render 'transition-cover' %}

    <div class="transition-body">
      {%- if template.suffix == 'muslin-blanket-le-new' -%}
        {% sections 'header-custom-group' %}
      {%- else -%}
        {% sections 'header-group' %}
      {%- endif -%}

      <div class="transition-content">
        <main id="MainContent" class="content-for-layout focus-none shopify-section" role="main" tabindex="-1">
          {{ content_for_layout }}
        </main>

        {% sections 'footer-group' %}
      </div>
    </div>

    {% sections 'overlay-group' %}

    <ul hidden>
      <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
    </ul>
    <svg xmlns="http://www.w3.org/2000/svg" class="hidden">
      <symbol id="icon-cart" fill="none" viewbox="0 0 18 19">
        <path d="M3.09333 5.87954L16.2853 5.87945V5.87945C16.3948 5.8795 16.4836 5.96831 16.4836 6.07785V11.4909C16.4836 11.974 16.1363 12.389 15.6603 12.4714C11.3279 13.2209 9.49656 13.2033 5.25251 13.9258C4.68216 14.0229 4.14294 13.6285 4.0774 13.0537C3.77443 10.3963 2.99795 3.58502 2.88887 2.62142C2.75288 1.42015 0.905376 1.51528 0.283581 1.51478" stroke="currentColor"/>
        <path d="M13.3143 16.8554C13.3143 17.6005 13.9183 18.2045 14.6634 18.2045C15.4085 18.2045 16.0125 17.6005 16.0125 16.8554C16.0125 16.1104 15.4085 15.5063 14.6634 15.5063C13.9183 15.5063 13.3143 16.1104 13.3143 16.8554Z" fill="currentColor"/>
        <path d="M3.72831 16.8554C3.72831 17.6005 4.33233 18.2045 5.07741 18.2045C5.8225 18.2045 6.42651 17.6005 6.42651 16.8554C6.42651 16.1104 5.8225 15.5063 5.07741 15.5063C4.33233 15.5063 3.72831 16.1104 3.72831 16.8554Z" fill="currentColor"/>
      </symbol>
    </svg>

    {%- if settings.image_loading_bar_enabled %}
      <script src="{{ 'lazyimage.js' | asset_url }}" async></script>
    {% endif -%}
    {%- if settings.predictive_search_enabled -%}
      <script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    {%- if settings.quick_view_enabled -%}
      <script src="{{ 'quick-view.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    {%- if settings.color_swatches_enabled -%}
      <script src="{{ 'color-swatches.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    {%- if linklists.gift-wrapping.links != blank and linklists.gift-wrapping.links.first.type == 'product_link' -%}
      <script src="{{ 'gift-wrapping.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
    
    {% render 'js-utilities' %}
    <script>
        const TIMER_DURATION = 300;
        let timerInterval = null;
        let timerEndTime = null;

        window.initializeTimer = function() {
            // Only set endTime if it doesn't exist or has expired
            if (!timerEndTime || timerEndTime <= Date.now()) {
                timerEndTime = Date.now() + (TIMER_DURATION * 1000);
            }
            
            // Clear any existing interval to prevent duplicates
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerInterval = setInterval(() => {
                const remaining = Math.max(0, timerEndTime - Date.now());
                const seconds = Math.ceil(remaining / 1000);
                
                if (seconds <= 0) {
                    timerEndTime = Date.now() + (TIMER_DURATION * 1000);
                }
                
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const timerElement = document.getElementById('timer-d5');
                if (timerElement) {
                    timerElement.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                }
            }, 100);
        }
        
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('checkout-btn-d5')) {
            const savedState = localStorage.getItem('cozycare_protection');
              if (savedState === 'true') {
                        e.preventDefault();
                       fetch('/cart/add.js', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                id: e.target.getAttribute('data-variant-id'), 
                                quantity: 1       
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                          window.location.href = '/checkout'
                        })
                        .catch(error => {
                          window.location.href = '/checkout'
                        });

                      }
                    }
                });

          window.initOrderProtection = function() {
            const toggle = document.getElementById('orderProtection');
            const subtotal = document.querySelector('.text-price-d5');
            if (toggle) {
                const savedState = localStorage.getItem('cozycare_protection');
                if (savedState === 'true') {
                    toggle.checked = true;
                      subtotal.textContent = subtotal.getAttribute('data-checked-price');
                }else{
                  subtotal.textContent = subtotal.getAttribute('data-unchecked-price');
                }
            }
        }

        window.handleProtectionChange = function(toggle) {
            const subtotal = document.querySelector('.text-price-d5');

            if (toggle && toggle.checked !== undefined && subtotal) {
                if (toggle.checked) {
                    subtotal.textContent = subtotal.getAttribute('data-checked-price');
                } else {
                    subtotal.textContent = subtotal.getAttribute('data-unchecked-price');
                }

                localStorage.setItem('cozycare_protection', toggle.checked.toString());
            }
        }
      document.addEventListener('DOMContentLoaded', function() {
        const key = parseInt(document.querySelector('.remove-protection-d5').getAttribute('data-key'));
        fetch('/cart/change.js', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                line: key,
                quantity: 0
            })
        })
        .then(response => response.json())
        .then(data => {
            //window.location.href = '/cart';
        })
        .catch(error => {
            console.error('Error removing item from cart:', error);
        });
    });



    </script>

    {% if settings.disable_inspect %}
      <script>
        window.addEventListener("contextmenu", (e) => {
          e.preventDefault();
        });
        document.addEventListener("selectstart", (e) => {
          e.preventDefault();
        });
        document.addEventListener('DOMContentLoaded', function() {
          document.querySelectorAll('img').forEach(img => {
            img.addEventListener('dragstart', function(e) {
              e.preventDefault();
            })
          })
        })
        function ctrlShiftKey(e, keyCode) {
          return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);
        }
        document.addEventListener('keydown', function(e) {
          if (
            event.keyCode === 123 ||
            ctrlShiftKey(e, 'I') ||
            ctrlShiftKey(e, 'J') ||
            ctrlShiftKey(e, 'C') ||
            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0))
          ) {
            e.preventDefault();
          }
        })
      </script>
    {% endif %}

    <script src="//cdn.shopify.com/s/files/1/0690/1995/9522/files/optimizer.js?v=1709233602" type="text/javascript"></script>
    {% if template.name == "checkout" and checkout.order_id %}
      <script>
      gtag('event', 'purchase', {
        transaction_id: "{{ checkout.order_number }}",
        value: {{ checkout.total_price | money_without_currency }},
        currency: "{{ shop.currency }}",
        // ... rest of GA tracking
      });
      </script>
    {% endif %}
  </body>
</html>
