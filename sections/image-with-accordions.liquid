{%- style -%}
  #shopify-section-{{ section.id }} {
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    
    /* Use custom colors or fallback to theme settings if not checked */
    {%- if section.settings.use_custom_colors %}
      --color-background: {{ section.settings.colors_background.red }}, {{ section.settings.colors_background.green }}, {{ section.settings.colors_background.blue }};
      --color-foreground: {{ section.settings.colors_text.red }}, {{ section.settings.colors_text.green }}, {{ section.settings.colors_text.blue }};
      --gradient-background: {% if section.settings.gradient_background != blank %}{{ section.settings.gradient_background }}{% else %}{{ section.settings.colors_background }}{% endif %};
    {%- else -%}
       /* Fallbacks usually inherit from theme.css, but defining basic vars here just in case */
       --color-foreground: 33, 35, 38; 
       --color-background: 255, 255, 255;
    {% endif -%}
  }

  @media screen and (max-width: 749px) {
    #shopify-section-{{ section.id }} {
      --section-padding-top: {{ section.settings.padding_top_mob }}px;
      --section-padding-bottom: {{ section.settings.padding_bottom_mob }}px;
    }
  }

  /* --- Main Layout Styles --- */
  .section-{{ section.id }}-padding {
    padding-top: var(--section-padding-top);
    padding-bottom: var(--section-padding-bottom);
    background: var(--gradient-background, rgb(var(--color-background)));
    color: rgb(var(--color-foreground));
  }

  .faq-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Header Styles */
  .faq-header {
    margin-bottom: 40px;
    max-width: 800px; /* Prevent text from getting too wide on centered layouts */
  }
  .faq-header.text-left { text-align: left; margin-right: auto; }
  .faq-header.text-center { text-align: center; margin-left: auto; margin-right: auto; }
  .faq-header.text-right { text-align: right; margin-left: auto; }

  .faq-header h2 {
    font-size: 2.4rem;
    margin-bottom: 1rem;
    line-height: 1.2;
    color: rgb(var(--color-foreground));
  }
  .faq-header .rte {
    font-size: 1.1rem;
    opacity: 0.85;
  }
  .faq-header .rte a {
    text-decoration: underline;
    color: inherit;
  }

  /* Content Grid (Image + Accordion) */
  .faq-content-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: start;
  }

  /* Left Column: Image */
  .faq-image-container {
    position: relative;
    width: 100%;
    border-radius: 20px; /* Matching the screenshot rounded corners */
    overflow: hidden;
    line-height: 0;
  }
  .faq-image-container img {
    width: 100%;
    height: auto;
    object-fit: cover;
    display: block;
  }

  /* Right Column: Accordion */
  .faq-accordion-list {
    display: flex;
    flex-direction: column;
    border-top: 1px solid rgba(var(--color-foreground), 0.1);
  }

  .faq-accordion-item {
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }

  .faq-accordion-summary {
    list-style: none;
    padding: 20px 0;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.1rem;
    font-weight: 500;
  }
  
  /* Remove default details marker */
  .faq-accordion-summary::-webkit-details-marker { display: none; }

  /* Icon rotation */
  .faq-icon {
    width: 12px;
    height: 12px;
    transition: transform 0.3s ease;
    opacity: 0.6;
  }
  details[open] .faq-accordion-summary .faq-icon {
    transform: rotate(180deg);
  }

  /* Smooth Animation Logic */
  .faq-accordion-content {
    overflow: hidden;
    max-height: 0; /* JS will toggle this */
    opacity: 0;
    transition: max-height 0.35s ease, opacity 0.35s ease, padding 0.35s ease;
  }
  
  details[open] .faq-accordion-content {
    /* These styles are handled by JS for smooth calculation, 
       but we keep defaults here for fallback */
    opacity: 1;
    padding-bottom: 20px;
  }

  /* Mobile Responsive */
  @media screen and (max-width: 768px) {
    .faq-content-wrapper {
      grid-template-columns: 1fr;
      gap: 30px;
    }
    .faq-header h2 { font-size: 1.8rem; }
  }
{%- endstyle -%}

<div class="section-{{ section.id }}-padding">
  <div class="faq-container">
    
    {%- comment -%} HEADER SECTION {%- endcomment -%}
    {%- if section.settings.heading != blank or section.settings.description != blank -%}
      <div class="faq-header text-{{ section.settings.header_alignment }}">
        {%- if section.settings.heading != blank -%}
          <h2>{{ section.settings.heading | escape }}</h2>
        {%- endif -%}
        {%- if section.settings.description != blank -%}
          <div class="rte">{{ section.settings.description }}</div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- comment -%} MAIN CONTENT {%- endcomment -%}
    <div class="faq-content-wrapper">
      
      <div class="faq-image-container">
        {%- if section.settings.image != blank -%}
          {{ section.settings.image | image_url: width: 800 | image_tag: 
            loading: 'lazy', 
            sizes: '(min-width: 768px) 50vw, 100vw', 
            widths: '375, 550, 750, 1100'
          }}
        {%- else -%}
          {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
      </div>

      <div class="faq-accordion-list">
        {%- for block in section.blocks -%}
          <details class="faq-accordion-item" {{ block.shopify_attributes }}>
            <summary class="faq-accordion-summary">
              <span>{{ block.settings.question | escape }}</span>
              <span class="faq-icon">
                <svg viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg" style="width:14px; height:auto; display:block;">
                  <path d="M1 1L7 7L13 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </summary>
            <div class="faq-accordion-content">
              <div class="rte">{{ block.settings.answer }}</div>
            </div>
          </details>
        {%- endfor -%}
      </div>

    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionId = '{{ section.id }}';
    const container = document.querySelector(`#shopify-section-${sectionId}`);
    const detailsElements = container.querySelectorAll('details');

    detailsElements.forEach((detail) => {
      const summary = detail.querySelector('summary');
      const content = detail.querySelector('.faq-accordion-content');

      summary.addEventListener('click', (e) => {
        e.preventDefault(); // Stop default instant toggle
        
        // 1. Close other open accordions (Accordion behavior)
        detailsElements.forEach((otherDetail) => {
          if (otherDetail !== detail && otherDetail.hasAttribute('open')) {
            const otherContent = otherDetail.querySelector('.faq-accordion-content');
            closeAccordion(otherDetail, otherContent);
          }
        });

        // 2. Toggle current
        if (detail.hasAttribute('open')) {
          closeAccordion(detail, content);
        } else {
          openAccordion(detail, content);
        }
      });
    });

    function openAccordion(detail, content) {
      detail.setAttribute('open', '');
      // Wait a tick for the attribute to apply, then animate
      requestAnimationFrame(() => {
        content.style.maxHeight = content.scrollHeight + 'px';
        content.style.opacity = '1';
        content.style.paddingBottom = '20px'; // Match CSS
      });
    }

    function closeAccordion(detail, content) {
      content.style.maxHeight = '0px';
      content.style.opacity = '0';
      content.style.paddingBottom = '0px';
      
      // Remove 'open' attribute after animation finishes
      setTimeout(() => {
        detail.removeAttribute('open');
      }, 350); // Match transition duration in CSS
    }
  });
</script>

{% schema %}
{
  "name": "Image with FAQ Accordion",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions:"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Can't find your answer? Check out our FAQ page.</p>"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Main Image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Left Side Image"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "checkbox",
      "id": "use_custom_colors",
      "default": false,
      "label": "Use custom colors"
    },
    {
      "type": "color",
      "id": "colors_text",
      "label": "Text color",
      "default": "#212326"
    },
    {
      "type": "color",
      "id": "colors_background",
      "label": "Background color",
      "default": "#f4f6fa"
    },
    {
      "type": "color_background",
      "id": "gradient_background",
      "label": "Gradient background"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_top_mob",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top (mobile)",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom_mob",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom (mobile)",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "accordion_item",
      "name": "Question",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "How do I wash a Zelesta duvet?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>Simply put it in the machine at 40 degrees.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image with FAQ Accordion",
      "blocks": [
        { "type": "accordion_item" },
        { "type": "accordion_item" },
        { "type": "accordion_item" }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}