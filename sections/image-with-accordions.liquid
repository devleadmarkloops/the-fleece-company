{%- style -%}
  #shopify-section-{{ section.id }} {
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    {%- if section.settings.use_custom_colors %}
      --gradient-background: {% if section.settings.gradient_background != blank %}{{ section.settings.gradient_background }}{% else %}{{ section.settings.colors_background }}{% endif %};
      --color-background: {{ section.settings.colors_background.red }}, {{ section.settings.colors_background.green }}, {{ section.settings.colors_background.blue }};
      --color-foreground: {{ section.settings.colors_text.red }}, {{ section.settings.colors_text.green }}, {{ section.settings.colors_text.blue }};
      --color-heading: var(--color-foreground);
    {% endif -%}
  }

  @media screen and (max-width: 749px) {
    #shopify-section-{{ section.id }} {
      --section-padding-top: {{ section.settings.padding_top_mob }}px;
      --section-padding-bottom: {{ section.settings.padding_bottom_mob }}px;
    }
  }

  #shopify-section-{{ section.id }} .image-with-accordions-section {
    background: rgb(var(--color-background));
    background: var(--gradient-background);
  }

  #shopify-section-{{ section.id }} .section-header {
    text-align: {{ section.settings.header_alignment }};
    margin-bottom: 3rem;
  }

  #shopify-section-{{ section.id }} .section-header h2 {
    color: rgb(var(--color-foreground));
    margin-bottom: 1rem;
  }

  #shopify-section-{{ section.id }} .section-header .rte {
    color: rgb(var(--color-foreground));
  }

  #shopify-section-{{ section.id }} .content-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .image-column img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
  }

  #shopify-section-{{ section.id }} .accordion-wrapper {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  #shopify-section-{{ section.id }} .accordion-item {
    border: 1px solid rgba(var(--color-foreground), 0.1);
    border-radius: 8px;
    overflow: hidden;
    background: rgba(var(--color-background), 1);
  }

  #shopify-section-{{ section.id }} .accordion-header {
    width: 100%;
    padding: 1.5rem;
    background: transparent;
    border: none;
    text-align: left;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    transition: background-color 0.3s ease;
  }

  #shopify-section-{{ section.id }} .accordion-header:hover {
    background: rgba(var(--color-foreground), 0.03);
  }

  #shopify-section-{{ section.id }} .accordion-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: rgb(var(--color-foreground));
    margin: 0;
  }

  #shopify-section-{{ section.id }} .accordion-icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  #shopify-section-{{ section.id }} .accordion-icon svg {
    width: 100%;
    height: 100%;
    stroke: rgb(var(--color-foreground));
  }

  #shopify-section-{{ section.id }} .accordion-item.active .accordion-icon {
    transform: rotate(180deg);
  }

  #shopify-section-{{ section.id }} .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.4s ease;
  }

  #shopify-section-{{ section.id }} .accordion-item.active .accordion-content {
    max-height: 500px;
    padding: 0 1.5rem 1.5rem;
  }

  #shopify-section-{{ section.id }} .accordion-text {
    color: rgba(var(--color-foreground), 0.8);
    line-height: 1.6;
  }

  @media screen and (max-width: 989px) {
    #shopify-section-{{ section.id }} .content-wrapper {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    #shopify-section-{{ section.id }} .image-column {
      order: -1;
    }
  }

  @media screen and (max-width: 749px) {
    #shopify-section-{{ section.id }} .section-header {
      margin-bottom: 2rem;
    }

    #shopify-section-{{ section.id }} .accordion-title {
      font-size: 1rem;
    }

    #shopify-section-{{ section.id }} .accordion-header {
      padding: 1.25rem;
    }
  }
{%- endstyle -%}

<div class="image-with-accordions-section">
  <div class="section--padding">
    <div class="page-width">
      {%- if section.settings.heading != blank or section.settings.description != blank -%}
        <div class="section-header">
          {%- if section.settings.heading != blank -%}
            <h2 class="h2">{{ section.settings.heading }}</h2>
          {%- endif -%}
          {%- if section.settings.description != blank -%}
            <div class="rte">{{ section.settings.description }}</div>
          {%- endif -%}
        </div>
      {%- endif -%}

      <div class="content-wrapper">
        <div class="image-column">
          {%- if section.settings.image != blank -%}
            <img 
              src="{{ section.settings.image | image_url: width: 800 }}"
              alt="{{ section.settings.image.alt | escape }}"
              loading="lazy"
              width="{{ section.settings.image.width }}"
              height="{{ section.settings.image.height }}"
            >
          {%- else -%}
            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
          {%- endif -%}
        </div>

        <div class="accordion-column">
          <div class="accordion-wrapper">
            {%- for block in section.blocks -%}
              <div class="accordion-item {% if forloop.first %}active{% endif %}" data-accordion-item {{ block.shopify_attributes }}>
                <button class="accordion-header" type="button" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}">
                  <h3 class="accordion-title">{{ block.settings.question }}</h3>
                  <span class="accordion-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                  </span>
                </button>
                <div class="accordion-content">
                  <div class="accordion-text rte">
                    {{ block.settings.answer }}
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const accordionItems = document.querySelectorAll('#shopify-section-{{ section.id }} .accordion-item');
    
    accordionItems.forEach(item => {
      const header = item.querySelector('.accordion-header');
      
      header.addEventListener('click', function() {
        const isActive = item.classList.contains('active');
        
        // Close all accordion items
        accordionItems.forEach(otherItem => {
          otherItem.classList.remove('active');
          otherItem.querySelector('.accordion-header').setAttribute('aria-expanded', 'false');
        });
        
        // Open clicked item if it wasn't active
        if (!isActive) {
          item.classList.add('active');
          header.setAttribute('aria-expanded', 'true');
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Image with Accordions",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Can't find your question here? Check out our FAQ page or send us a message via live chat. We're happy to help!</p>"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "label": "Header alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "checkbox",
      "id": "use_custom_colors",
      "default": false,
      "label": "Use custom colors"
    },
    {
      "type": "color",
      "id": "colors_text",
      "label": "Text color",
      "default": "#212326"
    },
    {
      "type": "color",
      "id": "colors_background",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color_background",
      "id": "gradient_background",
      "label": "Gradient background"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_top_mob",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top (mobile)",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom_mob",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom (mobile)",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "accordion_item",
      "name": "Accordion Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "How do I wash a Zelesta duvet?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>Our duvets are machine washable. Simply wash on a gentle cycle with cold water and tumble dry on low heat.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image with Accordions",
      "blocks": [
        {
          "type": "accordion_item",
          "settings": {
            "question": "How do I wash a Zelesta duvet?",
            "answer": "<p>Our duvets are machine washable. Simply wash on a gentle cycle with cold water and tumble dry on low heat.</p>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "question": "Which duvet prevents night sweats?",
            "answer": "<p>Our temperature-regulating duvets with moisture-wicking properties are perfect for preventing night sweats.</p>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "question": "Why are Zelesta duvets better for hygiene?",
            "answer": "<p>Zelesta duvets are hypoallergenic and antimicrobial, creating a cleaner sleeping environment.</p>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "question": "What are the benefits of a lightweight duvet?",
            "answer": "<p>Lightweight duvets provide comfort without excess weight, perfect for year-round use and easy care.</p>"
          }
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  }
}
{% endschema %}
