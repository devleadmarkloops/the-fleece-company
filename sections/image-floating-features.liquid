{%- style -%}
  #shopify-section-{{ section.id }} {
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    --line-color: {{ section.settings.line_color }};
    --line-gap: 15px;
    {%- if section.settings.use_custom_colors %}
      --color-background: {{ section.settings.colors_background }};
      --color-foreground: {{ section.settings.colors_text }};
      --color-heading: {{ section.settings.colors_text }};
    {% endif -%}
  }

  {%- if section.settings.use_custom_colors %}
    #shopify-section-{{ section.id }} .floating-features-wrapper {
      background-color: var(--color-background);
      color: var(--color-foreground);
    }
    
    #shopify-section-{{ section.id }} .title,
    #shopify-section-{{ section.id }} .floating-feature__title,
    #shopify-section-{{ section.id }} .rte,
    #shopify-section-{{ section.id }} .floating-feature-item {
      color: var(--color-foreground);
    }
  {%- endif -%}

  #shopify-section-{{ section.id }} .title-wrapper {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 3.5rem;
  }

  #shopify-section-{{ section.id }} .title-wrapper.left { 
    align-items: flex-start; 
    text-align: left; 
  }

  #shopify-section-{{ section.id }} .title-wrapper.center { 
    align-items: center; 
    text-align: center; 
  }

  #shopify-section-{{ section.id }} .title-wrapper.right { 
    align-items: flex-end; 
    text-align: right; 
  }

  #shopify-section-{{ section.id }} .title-wrapper .title, 
  #shopify-section-{{ section.id }} .title-wrapper .subheading { 
    margin: 0; 
  }

  #shopify-section-{{ section.id }} .title-wrapper .title {
    font-family: var(--new-font-heading-family);
    letter-spacing: 0;
  }

  #shopify-section-{{ section.id }} .title-wrapper .subheading {
    font-family: var(--new-font-body-family);
    font-size: 1.4rem;
    font-weight: 500;
    letter-spacing: 0.2rem;
  }

  #shopify-section-{{ section.id }} .floating-features-main {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    max-width: 1200px;
    margin: 0 auto 4rem auto;
    overflow-x: clip; 
    padding: 0;
  }

  #shopify-section-{{ section.id }} .floating-features-center {
    position: relative;
    width: 100%;
    max-width: {{ section.settings.image_max_width }}px;
    z-index: 2;
  }

  #shopify-section-{{ section.id }} .floating-features-center img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: {{ section.settings.image_radius }}px;
  }

  #shopify-section-{{ section.id }} .floating-features-blocks-mobile {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin-top: 3rem;
  }
  
  #shopify-section-{{ section.id }} .floating-feature-item {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    text-align: left;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .floating-feature__icon {
    flex-shrink: 0;
    width: {{ section.settings.icon_size }}px;
    height: {{ section.settings.icon_size }}px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #shopify-section-{{ section.id }} .floating-feature__icon svg,
  #shopify-section-{{ section.id }} .floating-feature__icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  #shopify-section-{{ section.id }} .floating-feature__content { 
    flex: 1; 
  }
  
  #shopify-section-{{ section.id }} .floating-feature__title { 
    margin: 0 0 0.7rem 0;
    font-family: var(--new-font-heading-family);
    font-size: 2rem;
    font-weight: 400;
    position: relative;
    /* width: max-content; */
    max-width: 100%;
  }

  #shopify-section-{{ section.id }} .floating-feature__text { 
    margin: 0;
    font-family: var(--new-font-body-family);
    font-size: 1.6rem;
    color: rgba(var(--color-foreground), 0.75);
    letter-spacing: 0;
    line-height: 1.4;
  }

  #shopify-section-{{ section.id }} .floating-features-footer {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 2.5rem;
    margin-top: 4rem;
  }

  #shopify-section-{{ section.id }} .footer-trust-icons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 2rem;
  }

  #shopify-section-{{ section.id }} .trust-icon-item {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    font-size: 1.4rem;
    font-weight: 500;
  }

  #shopify-section-{{ section.id }} .trust-icon-item svg,
  #shopify-section-{{ section.id }} .trust-icon-item img {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
  }

  @media screen and (min-width: 900px) {
    #shopify-section-{{ section.id }} .floating-features-blocks-mobile {
      display: none;
    }

    #shopify-section-{{ section.id }} .floating-feature-item {
      position: absolute;
      width: max-content;
      max-width: 280px;
      transform: translateY(-50%); 
      flex-direction: column !important;
      gap: 0.8rem;
      z-index: 3;
    }

    #shopify-section-{{ section.id }} .floating-feature__title::before {
      content: '';
      position: absolute;
      height: 2px;
      background-color: var(--line-color);
      top: 50%;
      width: var(--line-length);
      pointer-events: none;
    }

    #shopify-section-{{ section.id }} .floating-feature__title::after {
      content: '';
      position: absolute;
      height: 10px;
      width: 10px;
      background-color: var(--line-color);
      border-radius: 50%;
      top: calc(50% - 4px);
      pointer-events: none;
    }

    #shopify-section-{{ section.id }} .floating-feature-item[data-side="left"] {
      right: calc(100% + 4rem); 
      align-items: flex-end;
      text-align: right;
    }

    #shopify-section-{{ section.id }} [data-side="left"] .floating-feature__title::before {
      left: calc(100% + var(--line-gap));
      right: auto;
    }

    #shopify-section-{{ section.id }} [data-side="left"] .floating-feature__title::after {
      left: calc(100% + var(--line-gap) + var(--line-length) - 5px);
      right: auto;
    }

    #shopify-section-{{ section.id }} .floating-feature-item[data-side="right"] {
      left: calc(100% + 4rem); 
      align-items: flex-start;
      text-align: left;
    }

    #shopify-section-{{ section.id }} [data-side="right"] .floating-feature__title::before {
      right: calc(100% + var(--line-gap));
      left: auto;
    }

    #shopify-section-{{ section.id }} [data-side="right"] .floating-feature__title::after {
      right: calc(100% + var(--line-gap) + var(--line-length) - 5px);
      left: auto;
    }
  }

  @media screen and (max-width: 899px) {
    #shopify-section-{{ section.id }} .floating-features-center .floating-feature-item {
      display: none;
    }
    
    #shopify-section-{{ section.id }} .floating-feature__title::before,
    #shopify-section-{{ section.id }} .floating-feature__title::after {
      content: none !important;
      display: none !important;
    }
  }
{%- endstyle -%}

<div class="floating-features-wrapper section--padding{% if section.settings.show_divider %} section--divider{% endif %}">
  <div class="page-width">
    
    <div class="title-wrapper{% if section.settings.heading == blank and section.settings.subheading == blank %} title-wrapper--no-heading{% endif %} {{ section.settings.heading_alignment }}">
      {%- if section.settings.subheading != blank -%}
        <div class="subheading rte">{{ section.settings.subheading }}</div>
      {%- endif -%}
      {%- if section.settings.heading != blank -%}
        <{{ section.settings.heading_tag }} class="title {{ section.settings.heading_size }}">
          {{ section.settings.heading }}
        </{{ section.settings.heading_tag }}>
      {%- endif -%}
    </div>

    <div class="floating-features-main">
      <div class="floating-features-center">
        
        {%- if section.settings.main_image != blank -%}
          {{ section.settings.main_image | image_url: width: 1000 | image_tag: loading: 'lazy', class: 'main-center-image' }}
        {%- else -%}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg main-center-image' }}
        {%- endif -%}

        {%- for block in section.blocks -%}
          <div class="floating-feature-item" 
               data-side="{{ block.settings.side }}" 
               style="top: {{ block.settings.position_top }}%; --line-length: {{ block.settings.line_length }}px;" 
               {{ block.shopify_attributes }}>
            <div class="floating-feature__icon">
              {%- if block.settings.icon_svg != blank -%}
                {{ block.settings.icon_svg }}
              {%- elsif block.settings.icon_image != blank -%}
                <img src="{{ block.settings.icon_image | image_url: width: 100 }}" alt="" loading="lazy">
              {%- endif -%}
            </div>
            <div class="floating-feature__content">
              {%- if block.settings.heading != blank -%}
                <h4 class="floating-feature__title">{{ block.settings.heading }}</h4>
              {%- endif -%}
              {%- if block.settings.text != blank -%}
                <div class="floating-feature__text rte">{{ block.settings.text }}</div>
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>

    <div class="floating-features-blocks-mobile">
      {%- for block in section.blocks -%}
        <div class="floating-feature-item">
          <div class="floating-feature__icon">
            {%- if block.settings.icon_svg != blank -%}
              {{ block.settings.icon_svg }}
            {%- elsif block.settings.icon_image != blank -%}
              <img src="{{ block.settings.icon_image | image_url: width: 100 }}" alt="" loading="lazy">
            {%- endif -%}
          </div>
          <div class="floating-feature__content">
            {%- if block.settings.heading != blank -%}
              <h4 class="floating-feature__title">{{ block.settings.heading }}</h4>
            {%- endif -%}
            {%- if block.settings.text != blank -%}
              <div class="floating-feature__text rte">{{ block.settings.text }}</div>
            {%- endif -%}
          </div>
        </div>
      {%- endfor -%}
    </div>

    <div class="floating-features-footer">
      {%- if section.settings.button_label != blank -%}
        <a {% if section.settings.button_link != blank %}href="{{ section.settings.button_link }}"{% else %}role="link" aria-disabled="true"{% endif %} 
           class="button{% if section.settings.button_style_secondary %} button--secondary{% else %} button--primary{% endif %}">
          {{ section.settings.button_label | escape }}
        </a>
      {%- endif -%}

      <div class="footer-trust-icons">
        {%- for i in (1..3) -%}
          {%- assign icon_svg_key = 'footer_icon_svg_' | append: i -%}
          {%- assign icon_img_key = 'footer_icon_image_' | append: i -%}
          {%- assign text_key = 'footer_text_' | append: i -%}
          
          {%- assign current_svg = section.settings[icon_svg_key] -%}
          {%- assign current_img = section.settings[icon_img_key] -%}
          {%- assign current_text = section.settings[text_key] -%}

          {%- if current_svg != blank or current_img != blank or current_text != blank -%}
            <div class="trust-icon-item">
              {%- if current_svg != blank -%}
                {{ current_svg }}
              {%- elsif current_img != blank -%}
                <img src="{{ current_img | image_url: width: 50 }}" alt="" loading="lazy">
              {%- endif -%}
              {%- if current_text != blank -%}
                <span>{{ current_text }}</span>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>

  </div>
</div>

{% schema %}
{
  "name": "Image Floating Features",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Why Choose Our Product",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "h2", "label": "Small" },
        { "value": "h1", "label": "Medium" },
        { "value": "h0", "label": "Large" }
      ],
      "default": "h1",
      "label": "Heading Size"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" },
        { "value": "h4", "label": "H4" },
        { "value": "p", "label": "Paragraph" }
      ],
      "default": "h2",
      "label": "Heading SEO Tag"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Header Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Main Center Image"
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Product Image"
    },
    {
      "type": "range",
      "id": "image_max_width",
      "min": 200,
      "max": 800,
      "step": 20,
      "unit": "px",
      "label": "Image Max Width (Desktop)",
      "default": 400
    },
    {
      "type": "range",
      "id": "image_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Image Border Radius",
      "default": 0
    },
    {
      "type": "header",
      "content": "Block Settings"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 20,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Block Icon Size",
      "default": 40
    },
    {
      "type": "header",
      "content": "Bottom CTA Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "checkbox",
      "id": "button_style_secondary",
      "default": false,
      "label": "Use Secondary Button Style"
    },
    {
      "type": "header",
      "content": "Bottom Trust Icons (Row)"
    },
    {
      "type": "html", "id": "footer_icon_svg_1", "label": "Icon SVG 1"
    },
    {
      "type": "image_picker", "id": "footer_icon_image_1", "label": "Icon Image 1"
    },
    {
      "type": "text", "id": "footer_text_1", "label": "Text 1", "default": "Free Shipping"
    },
    {
      "type": "html", "id": "footer_icon_svg_2", "label": "Icon SVG 2"
    },
    {
      "type": "image_picker", "id": "footer_icon_image_2", "label": "Icon Image 2"
    },
    {
      "type": "text", "id": "footer_text_2", "label": "Text 2", "default": "Secure Checkout"
    },
    {
      "type": "html", "id": "footer_icon_svg_3", "label": "Icon SVG 3"
    },
    {
      "type": "image_picker", "id": "footer_icon_image_3", "label": "Icon Image 3"
    },
    {
      "type": "text", "id": "footer_text_3", "label": "Text 3", "default": "Money-Back Guarantee"
    },
    {
      "type": "header",
      "content": "Section Styling"
    },
    {
      "type": "checkbox",
      "id": "show_divider",
      "default": false,
      "label": "Show Top/Bottom Divider"
    },
    {
      "type": "color",
      "id": "line_color",
      "label": "Connector Line Color",
      "default": "#212326"
    },
    {
      "type": "checkbox",
      "id": "use_custom_colors",
      "default": false,
      "label": "Use Custom Colors"
    },
    {
      "type": "color",
      "id": "colors_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "colors_text",
      "label": "Text",
      "default": "#212326"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Floating Feature",
      "settings": [
        {
          "type": "header",
          "content": "Positioning (Desktop Only)"
        },
        {
          "type": "select",
          "id": "side",
          "label": "Side of Image",
          "options": [
            { "value": "left", "label": "Left Side" },
            { "value": "right", "label": "Right Side" }
          ],
          "default": "left"
        },
        {
          "type": "range",
          "id": "position_top",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Vertical Position",
          "default": 50,
          "info": "0% = Top, 100% = Bottom"
        },
        {
          "type": "range",
          "id": "line_length",
          "min": 50,
          "max": 300,
          "step": 10,
          "unit": "px",
          "label": "Connector Line Length",
          "default": 100
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "html",
          "id": "icon_svg",
          "label": "Icon SVG (Custom HTML)"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icon Image (Fallback)"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Feature Title"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Description",
          "default": "<p>Briefly describe the benefit or specification of this feature.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Floating Features",
      "blocks": [
        {
          "type": "feature",
          "settings": { "side": "left", "position_top": 30, "line_length": 120, "heading": "Ergonomic Design" }
        },
        {
          "type": "feature",
          "settings": { "side": "right", "position_top": 50, "line_length": 100, "heading": "Premium Materials" }
        },
        {
          "type": "feature",
          "settings": { "side": "left", "position_top": 70, "line_length": 120, "heading": "Long Battery Life" }
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  }
}
{% endschema %}